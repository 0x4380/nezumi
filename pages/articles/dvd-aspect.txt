====== проблемы DVD на широкоформатных экранах ======
<sub>{{DVD-aspect.odt|Original file}}</sub>

крис касперски ака мыщхъ, a.k.a nezumi, a.k.a elraton, no-email

**большинство лицензионных ****DVD ****не соответствуют критериям качества. записанные с грубыми нарушениями стандарта, они порождают многочисленные проблемы при их просмотре, особенно на широкоформатных домашних кинотеатрах. часть ошибок может быть устранена путем ремастеринга ****DVD ****на домашнем ПК, часть — лишь ослаблена до некоторой степени, чтобы просмотр фильма вызывал удовольствие, а не отвращение. сегодня в нашей тестовой лаборатории мы исследуем три популярных фильма на предмет соблюдения важнейшей потребительской характеристики — разрешения.**

{{INLINETOC}}
===== введение или небольшой ликбез для начинающих =====

DVD диск может хранить данные в любом виде (например, в MPEG4) и с любым разрешением, однако, стандарт предписывает хранить данные в MPEG2 в одном следующих разрешений, приведенных в таблицах 1 и 2.

В основном, в России встречаются два типа DVD: с видеоматериалом в формате PAL ("родным" разрешением для которого является 720 x 576) и NTSC (с разрешением 720 x 480). На первый взгляд, PAL-диски намного предпочтительнее, поскольку обладают на 20% большим разрешением по вертикали чем NTSC, однако… все дело в том, достаточно многие DVD выпускаются сначала в NTSC формате (ареал "обитания" которого охватывает Северную Америку и Японию) и переводятся в PAL не с оригинального носителя (кинопленки, например), а с… NTSC-DVD, особенно это часто случается с "лицензионными" дисками, записанными со спутникового телевидения или скопированными с NTSC-дисков, купленных в американских магазинах. Естественно, в обоих случаях, перевод в PAL-формат не приводит к увеличению разрешения, а осуществляется путем добавления мерзких черных полос сверху и снизу изображения.

Другой немаловажный момент: в большинстве случаев нам придется иметь дело с дисками, записанными с разрешением 720 x 576 и 720 x 480 пикселей для PAL/NTSC соответственно. Простой подсчет показывает, что 720 x 576 соответствует соотношению 5:4 (1,25), а вот 720 x 480 слегка "закаливает" за него (при своем соотношении 1,5) и при попытке вывода изображения 1:1, лица растягиваются по горизонтали. Чтобы этого безобразия не происходило большинство телевизоров имеют соотношение сторон 4:3 (1.33), более или менее корректно отображая как PAL, так и NTSC без особых искажений.

А что делать при выводе широкоформатного (16:9) фильма?! Некоторые (между прочим, достаточно многие!) производители не мудрствуя лукаво просто ужимают изображение по вертикали, добавляя черные полосы, в результате чего на PAL материале мы получаем фактическое разрешение всего лишь в 720 x 405, что даже меньше, чем "нормальное" NTSC-разрешение!

На самом деле "фирменные" DVD //**всегда**// записываются с разрешением 720 x 576/720 x 480 //**независимо**// от того с каким видеоматериалом (5:4 или 16:9) мы имеем дело. В MPEG2 заголовок записывается аспект (т. е. соотношение сторон) и DVD-проигрыватель масштабирует изображение "на лету". В результате, мы сохраняем полное разрешение по вертикали и на телевизоре с большим экраном качество ощутимо возрастает. Домашние кинотеатры и LCD мониторы с соотношением сторон 16:9 показывают широкоформатный фильм _без_ черных полос, поскольку на DVD их физически _нет_ и мы наслаждаемся картинкой по полной программе.

А теперь представим, что произойдет, если подать на вход широкоформатного телевизора/монитора видеофильм, записанный на DVD с разрешением 720 x 405. Мы увидим широкие черные полосы вместе с узкой "прослойкой" актуального изображения между ними. Вообще-то, умные DVD-плееры в такой ситуации могут растянуть изображение, избавившись от черных полос, но… из 405 точек по вертикали, получить исходные 576без потери качества, увы, невозможно.

Но это еще что!!! Некоторые "умельцы" ухитряются добавить черные полосы и по бокам, в результате чего для сохранения оригинального аспекта изображение не так сильно ужимается по вертикали, ну а потеря горизонтального разрешения менее критична.

Представляет огромный интерес взглянуть на популярные DVD-диски и посмотреть, удалось ли их производителям освоить MPEG2 формат или нет.

|разрешение|формат сжатия|кодовое название|поддержка 16:9 Anamorphic|
|720 x 576|MPEG2|Full-D1|+|
|704 x 576|MPEG2|—|—|
|352 x 576|MPEG2|Half-D1 (CVD-стандарт)|—|
|352 x 288|MPEG2|—|—|
|352 x 288|MPEG1|VCD-старндарт|—|

**Таблица 1 ряд стандартных разрешений для формата PAL**

|разрешение|формат сжатия|кодовое название|поддержка 16:9 Anamorphic|
|720 x 480|MPEG2|Full-D1|+|
|704 x 480|MPEG2|––|––|
|352 x 480|MPEG2|Half-D1 (CVD-стандарт)|—|
|352 x 240|MPEG2|––|––|
|352 x 240|MPEG1|VCD-стандарт|—|

**Таблица 2 ряд стандартных разрешений для формата NTSC**

===== как мы будем действовать =====

Для беспристрастного анализа DVD-дисков нам понадобится определенный инструментарий. Собственно говоря, подойдет _любое_ программное обеспечение, умеющее работать с DVD, например, знаменитый Gordian Knot, распространяемый на бесплатной основе: http://gknot.doom9.org/. Сначала установите Gordian Knot Codec Pack, содержащий набор всевозможных кодеков, а затем Gordian Knot Rip Pack. После этого можно приступать к работе, предварительно изучив руководство, которое можно найти там же на www.doom9.org.

Хорошо подходит для этой цели и популярный видео-редактор нелинейного монтажа AviDemux (http://fixounet.free.fr/avidemux/), обладающий интуитивно понятным интерфейсом, поддерживающий огромное количество выходных/выходных форматов, портированный на Linux, Windows, Mac OS и при всем этом — абсолютно бесплатный.

ОК, определившись с инструментарием, приступаем к тестированию в котором будет участвовать три DVD-диска: Shrek-II, Hannibal Rising и Hostel.

===== Shrek-II =====

Очаровательный мультик от Dream Works Pictures (2004 года), выпущенный ООО "Арена" на DVD‑9 в формате PAL с логотипом "коллекционное издание". При открытии DVD в программе **GDIndex** (входит в состав Gordian Knot), мы видим, что: а) это действительно PAL с разрешением 720 x 576 и соотношением сторон 16:9, что указывает на широкоформатный видеоматериал, однако, "визуально" (в GDIndex'е) он гораздо ближе к 5:4, что подтверждет "яйцеобразная" луна. На самом деле, именно так все и должно быть!!!

Производитель диска использовал разрешение DVD-диска на полную катушку, переложив заботу по масштабированию изображения на видеоплеер. В результате, мы сохранили полное разрешение изображения по вертикали, попутно избавившись от черных полос при выводе фильма на широкоформатный телевизор/монитор. Ну… практически избавились.

{{dvd-aspect_Image_0.png?553}}

**Рисунок 1 DVD диск с фильмом Shrek-II, открытый в программе DGIndex, сообщающий тип видеоматериала (PAL), соотношение сторон (16:9), а так же полное разрешение (720x576), включающее в себя наряду с полезным изображением мерзкие горизонтальные черные полосы и одну узкую вертикальную полосу по правому краю окна**

Даже при беглом взгляде на изображение обнаруживаются две черных полоски по горизонтали, и она узкая (широкой всего в два пикселя) полоса по правому краю, произвольным образом меняющая свой цвет с бардового на зеленый и обратно.

После обрезки всего лишнего в Gordian Knot'е (вкладка "Resolution" в главном окне программы) мы получаем _фактическое_ разрешение 718 x 552, что близко к соотношению 4:3 (718/552 == 1,3), то есть изображение оптимизировано для просмотра на обыкновенных телевизорах. А как же быть обладателям домашних широкоформатных кинотеатров?! А никак!!! Стандарт MPEG2 требует, чтобы и ширина, и высота изображения делились на 16 без остатка, чего в случае разрешения 718 x 552 явно не наблюдается. Можно, конечно, после обрезки черных полос растянуть изображение до 720 x 576, но качество от этого только упадет, поскольку resize-фильтры вносят существенные искажения.

Тем не менее, качество данного фильма находится на вполне пристойном уровне.

{{dvd-aspect_Image_1.png?552}}

**Рисунок 2 после обрезки черных полос разрешение уменьшается с 720 x 576 до 718 x 552, свидетельствуя о том, что фильм ориентирован для просмотра на домашних телевизорах**

===== Hannibal Rising =====

Психологический триллер 2007 года от Metro-Goldwyn-Mayer, выпущенный ООО "Диск ПРО" на DVD-9 в формате PAL, что GDIndex благополучно подтверждает, указывания на широкоформатный (16:9) видеоматериал, записанный в стандартном для PAL'а разрешении: 720 x576, но непристойное широкие черные полосы по всем четырем сторонам изображения нас убивают просто наповал.

{{dvd-aspect_Image_2.png?553}}

**Рисунок 3 DVD диск с фильмом Hannibal Rising, открытый в программе DGIndex, сообщающий тип видеоматериала (PAL), соотношение сторон (16:9), а так же полное разрешение (720x576), включающее в себя наряду с полезным изображением мерзкие вертикальные (!) и горизонтальные черные полосы**

После обрезки всего лишнего (а это без малого по 78 пикселей с каждой стороны по вертикали и по 12 пикселей с каждой стороны по горизонтали), мы получаем… 696 x 420 пикселей _эффективного_ разрешения, что не дотягивает даже до NTSC, но зато 696/420 ~ 16:9, то есть производитель диска "жестко" прошил аспект внутрь DVD, чудовищно проиграв при этом в разрешении и уже на обыкновенном телевизоре отчетливо видно, что качество не дотягивает даже до DVD-5, а на широкоформатном домашнем кинотеатре смотреть такое "чудо" без содрогания вообще невозможно!

{{dvd-aspect_Image_3.png?553}}

**Рисунок 4 после обрезки черных полос разрешение уменьшается с 720 x 576 до 696 x 420, косвенным образом свидетельствуя в пользу того, что создатель диска не знал как задать аспект в MPEG2 файле, либо же попросту не располагал видеоматериалом соответствующего разрешения**

===== Hostel =====

Фильм ужасов 2006 года от Квентина Тарантино (того, что снял Kill Bill), выпущенный ООО "Киномания" в NTSC-формате с логотипом "коллекционное издание" со стандартным для NTSC разрешением 720x480, однако, широкие черные полосы ужимают и без того невысокое NTSC разрешение до размеров почтовой марки.

{{dvd-aspect_Image_4.png?553}}

**Рисунок 5 DVD диск с фильмом Hostal, открытый в программе DGIndex, сообщающий тип видеоматериала (NTSC), соотношение сторон (16:9), полное разрешение (720x480), включающее в себя не только полезное изображение, но и широкие горизонтальные полосы**

Обрезав по 58 пикселей с каждой стороны по вертикали и по 2 пикселя с каждой стороны по горизонтали мы получаем…. нет, ну это уже вообще смешно сказать: 716 x 364 пикселей разрешения, соответствующих соотношению сторон в 1,97:1, что близко к соотношению 1.85:1, характерном для видеофильмов, демонстрируемых в кинотеатрах (что наводит на мысль о способе "лицензирования" фильма, а точнее об источение его получения), но все-таки 1,97:1 довольно далеко отстоит от 1.85:1. Почему?! Чтобы ответить на этот вопрос, нам придется углубится в тонкости MPEG4 формата, ставшим стандартом де-факто для обмена файлов по сети.

{{dvd-aspect_Image_5.png?552}}

**Рисунок 6 после обрезки черных полос разрешение уменьшается с 720 x 480 до 716 x 364, при котором о DVD-качестве просто смешно говорить**

===== как распознать MPEG2, полученный из MPEG4? =====

Многие DVD-диски в качестве исходного видеоматериала используют сильно пожатый MPEG4, конвертируя его обратно в MPEG2 для получения DVD-совместимого диска. _Доказать_ это очень просто. Цветовая схема, используемая в MPEG2, кодирует два соседних горизонтальных пикселя _одним_ цветом, за счет чего цветовое разрешение сокращается вдвое, увеличивая степень сжатия и не сильно сказываясь на качестве, поскольку человеческий глаз имеет достаточно низкое цветовое разрешение, зато чувствителен к яркости.

Разработчики MPEG4 пошли еще дальше и стали кодировать одним цветом матрицу из четырех пикселей, усредняя цвета смежных вертикальных и горизонтальных пикселей что, кстати говоря, породило проблему сжатия черезстрочечного видео, но об этом мы поговорим в следующий раз, а пока рассмотрим все три фильма под большим увеличением.

Начнем, естественно со Shreak'а (см. рис. 7):

{{dvd-aspect_Image_6.png?553}}

**Рисунок 7 контрастная граница черных полос диска со Shek'ом свидетельствует в пользу того, что он был скопирован с оригинального MPEG2 диска**

Резкая граница черной полосы указывает на то, что данный диск был записан с оригинального MPEG2 носителя и не подвергался сжатию в MPEG4, то есть с некоторой степенью достоверности его можно считать _действительно_ лицензионным DVD или качественной пираткой.

А вот теперь посмотрим на Hannibal Rising (см. рис. 8). Что мы видим?! Черная полоса не имеет резкой границы, а образует своеобразную "гамму", вызванную тем что MPEG4 усредняет цветовую составляющую соседних вертикальных и горизонтальных линий. Получить такой эффект на MPEG2 довольно затруднительно, следовательно, мы имеем дело с MPEG4-источником, а, поскольку, по официальным каналам видео-продукция в MPEG4 не распространяется, данный диск был получен каким-то очень интересным путем, я даже не берусь судить каким. Кстати говоря, на MPEG4 избежать эффекта "гаммы" очень просто. Достаточно, чтобы ширина черных полос была кратна 16 пикселям — т.е. размеру макро-блока, на которые MPEG4 разбивает сжимаемое изображение и границы которых никогда не "замыливаются".

{{dvd-aspect_Image_7.png?553}}

**Рисунок 8 цветовая гамма диска Hannibal Rising убедительно доказывает, что в качестве источника выступал видеоматериал в формате MPEG4**

Аналогичная ситуация наблюдается и с фильмом "Hostel" (см. рис. 9) — вместо резкой границы мы имеем плавную цветовую гамму. Стоит ли после этого удивляется низкому разрешению и какому-то странному соотношению сторон?! При просмотре на телевизоре с большим экраном, подобная "гамма" создает неприятный эффект "трехмерной выпуклости изображения" и способна испортить все впечатление от фильма, который, между прочим, стоит 20$, т. е. ровно столько же, сколько хороший лицензионный DVD, только вместо "DVD-качества" мы получаем многократно пережатый MPEG4, сграбленный неизвестно с какого источника.

{{dvd-aspect_Image_8.png?553}}

**Рисунок 9 цветовая гамма диска Hostel убедительно доказывает, что в качестве источника выступал видеоматериал в формате MPEG4**

===== исправление ошибок в условиях домашней лаборатории =====

Потерянное разрешение (и качество DVD, полученного из MPEG4) обратно уже не вернуть, но вот от черных полос избавиться можно. Их с удовольствием обрежет любой видео-редактор, только необходимо следить, чтобы размеры получившегося изображения были кратны 16 пикселям по вертикали и горизонтами, в противном случае, некоторые DVD-плееры откажутся воспроизводить такой файл или станут отображать его неправильно. Компьютерные плееры (и, в частности, знаменитый кодек FFDShow) в этом отношении намного более демократичны и за соотношением сторон можно в принципе и не следить, регулируя аспект уже в самом плеере (как легко заметить, после обрезания черных полос аспект заметно отличается от 16:9). Но это не самое страшное. Хуже всего, что после обрезания файл придется повторно сжимать, пусть даже обратно в MPEG2, однако, процедура распаковки/упаковки качеству только вредит и потому у многих пользователей возникает вопрос: а можно ли обрезать черные полосы _без) переупаковки MPEG2-файла?

Большинство "специалистов" считают, что нет, однако, они очень сильно заблуждаются. Фактически MPEG2-поток состоит из последовательности макро-блоков размером 16 x 16 пикселей, что позволяет нам изымать блоки, принадлежащие черным полосам без переупаковки всего файла (это умеют делать многие видео-редакторы, поддерживающие опцию Fast-Recompression, например, тот же AviDemux). Естественно, если ширина черных полос не кратна 16 пикселям, придется отрезать "рабочую" часть изображения, что не есть хорошо, однако… периферийные области кадров редко содержат критичные для понимания фильма элементы, в то время как повторный пережим _всего_ файла усиливает MPEG2-артефакты, резко снижая общее качество, а, значит, и впечатление от просмотра.

===== >>> сводная таблица качества тестируемых DVD =====

|фильм|материал-источник|качество|
|Shrek-II|MPEG2|отличное|
|Hannibal Rising|MPEG4|посредственное|
|Hostel|MPEG4|отвратительное|

===== заключение =====

Возникает резонный вопрос — для чего возиться с обрезкой и осваивать нелинейный видео-монтаж, когда можно просто купить готовый DVD, воткнуть его в плеер и наслаждаться жизнью? Увы! Количество _качественных_ DVD исчисляется единицами и если на обыкновенном телевизоре разница между "правильным" и "неправильным" диском несущественна, то при просмотре на широкоформатном домашнем кинотеатре — она просто колоссальна, но чтобы увидеть это — необходимо приобрести по крайней мере несколько качественных DVD, ведь помимо черных полос (на которые можно просто не обращать внимания) существуют и другие, гораздо более серьезные проблемы, но о них мы поговорим в следующих раз.


