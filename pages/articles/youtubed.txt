====== youtubed ======
<sub>{{youtubed.odt|Original file}}</sub>

====== эффективный грабеж видео с youtube\\ tagline1: капкан для цифрового видео\\ tagline2: перегон видео на hdd —советы бывалых\\ tagline3: (не)правильная скачка online видео на hdd ======

крис касперски, ака мыщъх, a.k.a. nezumi, a.k.a. souriz, no-email

**задача: скачать потоковое видео с ****youtube, google**** и прочих подобных ресурсов с максимальным качеством, минимальным трафиком без всяких платных утилит, получив в итоге стандартный ****avi**** и/или ****mpeg****-файл, проигрывающийся где угодно и на чем угодно. решение намного сложнее, чем можно подумать. существует множество программ и сетевых служб, предлагающих свои услуги, но… большинство из них либо нагло требуют денег, либо показывают рекламу, либо же выдают видео неоправданно низкого качества. на самом деле, чтобы решить проблему ничего, кроме браузера не нужно! главное — это правильно им воспользоваться!**

===== введение =====

С появлением широкополосных каналов и падением цены на трафик ниже плинтуса пользователи наперебой бросились обмениваться видео — как своими собственными "шедеврами", снятыми на дешевую камеру, так и вполне профессиональными клипами (а позднее — и целыми видеофильмами), надерганными со спутникового/кабельного/эфирного TV, фирменных DVD и прочих носителей, включая порядком потрепанные видеокассеты.

Долгое время основным источником дичи был Осел — клиент файлообменной сети eDonkey. В нем можно найти практически все, но! во-первых, скорость скачки оставляет желать лучшего и некоторые файлы скачиваются неделями или месяцами (!), что, кстати говоря, препятствует использованию Осла в Интернет-кафе. Во-вторых, во многих странах Осел объявлен вне закона и потому далеко не каждый системный администратор к нему благосклонен. В-третьих, качество представленных материалов варьируется в очень широких пределах от hi-fi до грубых подделок, так, например, скачивая клипы Агаты Кристи можно запросто заполучить своп от винды. Хорошо если трафик безлимитный. А если нет?!

Спрос рождает предложение и в сети появились ресурсы, специализирующиеся на распространении видеоматериалов, причем на совершенно легальной основе. Вместо того, чтобы крутить клипы на TV, отваливая за это бешенные бабки, намного выгоднее выложить их на YouTUBE, Google Video, iFilm, etc, где их увидят миллионы "зрителей", многие из которых захотят приобрести понравившийся альбом. Короче, "верхи", хоть и медленно, но неизбежно учатся торговать по новому, однако, их алчность и жажда наживы не дают сделать следующий шаг — выложить видео в свободный доступ, чтобы его мог скачать любой желающий, сохранив файл на жестком диске или другом носителе.

Смотреть же видео в реальном времени можно только на быстрых каналах и безлимитных тарифах. У большинства же отечественных пользователей такие каналы только в Интернет-кафе или на работе, а какой там просмотр? Ни комфорта, ни акустики… К тому же, нет никакой гарантии, что клип, кем-то закаченный сегодня в сеть, не исчезнет оттуда через несколько дней. Сохранив его на CD/DVD-R/RW, мы не только сэкономим деньги, когда захотим посмотреть его еще раз, но и гарантированно обеспечим возможность самого просмотра. Плюс — легкость передачи файла друзьям.

Впрочем, агитировать за сливание потокового видео на винчестер вроде бы ни к чему. Это всем и так понятно. Лучше рассказать как это осуществить.

===== >>> выноска 0 =====

**сейчас все ищут клипы не в Осле, а на ****YouTube ****или ****Google Video****, где можно найти практически _все_ причем с приличной скоростью отдачи и вполне приемлемом качестве. Главное — перегнать это богатство на свой жесткий диск.**

===== первые эксперименты =====

Идем на **www.youtube.com**, вводим в строку поиска название трека любимой группы (например, "Lordi —Would you love a monsterman"), щелкаем по самой хитовой ссылке в выпавшем списке и наслаждаемся видео, проигрываемом в окне размером чуть больше почтовой марки (см. рис. 1). Щелкаем по нему правой клавишей мыши — всплывает до боли знакомое меню Macromedia Flash Player'а. Ага, значит, сохранить файл в лоб не получится и придется идти в обход, что мы, собственно, сейчас и попытаемся сделать.

{{youtubed_Image_0.png}}

Рисунок 1 просмотр потокового видео на YouTube в режиме реального времени без возможности сохранения на жесткий диск

Выбираем просмотр страницы в виде HTML и контекстным поиском ищем файл с расширением ".swf" (типичное расширение для flash-файлов). Находим его в следующей строке: "SWFObject("**/player2.swf**?video_id=_r_zVWRCLQ0&l=187&t=OEgsToPDskLgwsiZBYkhAXZtRo6ilOwZ&soff=1&sk=EPO48pzXhu5cfjGX6pumKgC", "movie_player", "450", "370", v, "#FFFFFF")".

Пробуем сохранить swf-ролик на диск, создав HTML-файл следующего содержания:

<HTML>

<BODY>

<A href=http://www.youtube.com/player2.swf?video_id= _r_zVWRCLQ0&l=187&t=OEgsToPDskLgwsiZBYkhAXZtRo6ilOwZ&soff= 1&sk=EPO48pzXhu5cfjGX6pumKgC>Download</a>

</BODY>

</HTML>

Листинг 1 исходный текст HTML-файла, позволяющего скачать player2.swf на диск

Открываем его в браузере, щелкаем правой клавишей мыши по ссылке "Download", выбрав в развернувшимся контекстном меню пункт "Сохранить как…" и… что-то такое действительно начинает сохраняться… Только уж слишком быстро! Ну просто подозрительно быстро!!! На диск падает player2.swf весом чуть меньше 30 Кбайт. Ясно, что видео-контент содержаться в нем не может. На всякий случай перетягиваем его в окно IE и видим следующую картину (см. рис.2).

{{youtubed_Image_1.png}}

Рисунок 2 "голый" flash-плеер обманным путем выдранный из YouTube без видео-контента

Чистый flash-плеер собственной персоной! Можно даже сказать "девственно чистый", поскольку никакого видео к нему не прилагается, а жаль! Но ведь в кэше браузера видео однозначно есть! Ну не может там его не быть, ведь после окончания загрузки (когда красная полоска "градусника" добежит до конца) клип можно просматривать сколько угодно раз, без обращения к Интернету.

Итак, значит, кэш… У IE он находится в каталоге C:\Documents-n-Settings\<имя пользователя>\Local Settings\Temporary Internet Files\. Открываем его в штатном Проводнике или FAR'e. Ой-ой-ой!!! Да тут настоящая мусорная свалка! Эх… знать бы хоть что искать! А искать надо FLV-или реже AVI/WVM-файлы. Причем, на расширения внимания лучше не обращать. Очень часто их там вообще не оказывается и приходится анализировать заголовок. В частности, FLV файлы (чуть позже мы расскажем что это такое) имеют сигнатуру "FLV" в своем начале, благодаря чему их легко найти с помощью FAR'а, Total Commander'а или через меню Пуск  Поиск файлов.

Приступаем к поиску в кэше (<Alt-F7> в FAR'e) указав в имени файлов "*" (все файлы), в искомой строке — "FLV" и взводим галочку чувствительности к регистру для уменьшения количества ложных срабатываний. Даем FAR'у немного пошуршать диском и видим следующий результат (см. рис. 3): два файла с именами "get_video[1]" без расширения и один – с расширением FLV.

{{youtubed_Image_2.png}}

Рисунок 3 поиск видео-файлов в кэше браузера посредством FAR'a

Так вот, "get_video" — это и есть видео-файлы, скаченные с YouTube: он всегда дает им такие имена. Файл же с расширением .FLV остался после посещения сайта BBC. Размер файлов составляют колеблются от двух до восьми мегабайт, что делает их вполне правдоподобными кандидатами на роль хранителей видео.

Проверяем догадку путем перетаскивания "get_video[1]" на "Рабочий Стол" (или в любую другую папку), попутно меняя ему расширение на .FLV, после чего он будет замечательно смотреться в любом FLV-плеере, а если FLV-кодеки уже установлены в системе, то и на стандартном Windows-медиаплеере (только при этом расширение придется изменить на .AVI, поскольку медиаплеер по умолчанию не ассоциирует себя с FLV-файлами).

Задача-минимум успешно решена. Мы научились "выцарапывать" потоковое видео из кэша браузера, что намного предпочтительнее прямого скачивания разными качалками (зачем повторно скачивать то, что уже есть на диске?!). К тому же, в случае посещения Интернет-кафе или служебного компьютера коллективного пользования есть все шансы найти чужие видео-файлы, не оплачивая их скачивание из своего кармана.

===== >>> выноска 1 =====

**Файлы "****get_video*"****, хранящиеся в кэше браузера — это полноценные видео-файлы, в ****FLV-****формате, оставленные ****YouTube****. После изменения расширения в ****.FLV ****их можно просматривать любым подходящим ****FLV-****плеером.**

===== использование сторонних служб =====

Далеко не всем пользователям нравится ковыряться в кэше и еще меньше людей знают, что это вообще такое. Специально для них в сети появилось множество ресурсов, специализирующихся на "добыче" видео и перегоне его на жесткий диск.

Поклонники "Горящего Лиса" могут установить бесплатный плагин **VideoDownloader** (https://addons.mozilla.org/firefox/2390/) работающий чрез свою собственную бесплатную сетевую службу http://javimoya.com/blog/youtube_en.php, умеющую стягивать видео в формате FLV с YouTube, Google Video, iFilm, MetaCafe и пары десятков других менее популярных ресурсов. Здесь же (http://applian.com/flvplayer?src=VideoDownloadPlay) торчит ссылка на бесплатный FLV-плеер с уродливым интерфейсом и жестоко урезанными функциональными возможностями плюс отдельный конвертор FLV-файлов в остальные форматы (платный). Платить же нам, естественно, не хочется, а поэтому — ну его на фиг!

{{youtubed_Image_3.png}}

Рисунок 4 Video Downloader – популярный сетевой ресурс, специализирующийся на "грабеже" видео в FLV-формате (часто находится в дауне и временами гонит брак)

После установки плагина, в правом нижнем углу Горящего Лиса появляется иконка символизирующая гибрид видеоленты с дискетой (см. рис. 5), щелкнув по которой, мы можем скачать текущий просматриваемый ролик (см. рис. 6).

{{youtubed_Image_4.png}}

Рисунок 5 иконка активации Video Downloader'а в "Горящем Лисе"

При этом открывается еще одно окно (см. рис. 6) со ссылкой, щелкнув по которой можно сохранить видео-файл на диск, не забыв принудительно переименовать его в .FLV, поскольку VideoDownloader это сделать забывает.

{{youtubed_Image_5.png}}

Рисунок 6 скачивание видео с YouTube через Video Downloader

Все! Теперь можно праздновать победу и смотреть видео при помощи бесплатного FLV Player'а (см. рис. 7), пока не надоест. А надоест нам это быстро, поскольку, во-первых, захочется преобразовать FLV в какой-нибудь другой — более распространенный — формат, во-вторых, Video Downloader частенько "падает" от перегрузки, становясь недоступным в самый неподходящий момент, но даже когда он доступен, среди скаченных файлов нередко попадается явный брак, где звук отстает от изображения на несколько секунд. Почему так происходит и из какого места растут руки разработчиков — мыщъх'у неведомо.

{{youtubed_Image_6.png}}

Рисунок 7 просмотр скаченного видео в бесплатном FLV-плеере, предложенного службой Video Downloader

Ресурс **http://keepvid.com** (см. рис. 8) не только намного более устойчив к перегрузкам (и практически никогда не выпадает в осадок), но и в некоторых случаях позволяет скачивать видео в форматах AVI и/или MP4, правда, самостоятельной конвертацией он не занимается, а просто просит сервер отдавать видео во всех доступных"ипостасях".

Скачивание файлов осуществляется проще простого: копируем в строку "Download video" ссылку на видео из адресной строки браузера и нажимаем кнопку Download, выбрав один из предлагаемых форматов.

При этом стоит учитывать, что //**AVI **////**файлы примерно вдовое больше по объему, чем **////**FLV**////**, и "транслируются" с гораздо худшим качеством, причем, большинство из них записаны в слегка нестандартном формате, который понимают далеко не все плееры, так что лучше скачивать **////**FLV **////**и конвертировать его самостоятельно.**//

{{youtubed_Image_7.png}}

Рисунок 8 скачивание видео с YouTube через KeepVID (устойчиво работающая система с широкими возможностями)

===== >>> выноска 2 =====

**AVI ****и ****MP4**** файлы "весят" приблизительно вдвое больше, чем ****FLV****, и при этом "транслируются" в худшем качестве, поэтому, лучше скачивать видео в формате ****FLV****, а потом уже конвертировать его на своей машине в любой распространенный формат. этот нехитрый примем позволяет сэкономить огромное количество трафика.**

===== автономные видео-качалки =====

**YouTubeDownloader** – лучшая утилита из всех в своем классе. Основанная на открытой библиотеке ffmpeg, она полностью бесплатна, не гадит в реестре, переносится с компьютера на компьютер без установки и, что самое главное, позволяет сохранять видео с YouTube как в формате AVI, так и в формате MPEG (см. рис. 9), всегда скачивая файл в формате FLV и самостоятельно выполняя преобразование в полностью автоматизированном режиме, тщательно синхронизуязвук и изображение. Официальная страница последнее время лежит в хроническом дауне, поэтому приходится лазать по альтернативным источникам, например: http://dl.softportal.com/load/youtubed_setup.exe.

Единственный присущий ей недостаток — кроме YouTube она никого не знает и знать не желает, однако, это не очень большой минус, поскольку основная масса видео находится именно на YouTube, ну а все остальное можно скачать и руками, выдернув из кэша браузера или обратившись к сторонним сетевым службам.



{{youtubed_Image_8.png}}

Рисунок 9 внешний вид YouTube Downloader'а

Конкурирующие программы (из тех, что превосходят YouTube Downloader по функциональности) распространяются, как правило, за деньги, либо же показывают назойливую и трудноотключаемую рекламу и, что самое мерзкое, — довольно небрежно сводят звук с изображениям, что вынуждает пользователя устанавливать видеоредактор и изучать азы нелинейного монтажа. Ну, и кому это надо?!

===== заключение =====

Как только защищенный продукт становится популярным — его тут же ломают. Это закон! Еще никто не сумел (и _никогда_ не сумеет) придумать защиту, с которой бы ни справился пытливый человеческий ум распределенного сетевого сообщества. Пример со скачиванием потокового видео — лучшее тому подтверждение!

Как бы ни изощрялись владельцы видео-ресурсов, пытаясь удержать у себя пользователей и воспрепятствовать бесконтрольному распространению контента —эти попытки смешны и тщетны. И чем больше мы будем скачивать видео на свои жесткие диски, тем скорее откажутся правообладатели от этой затеи с защитой.

===== >>> врезка грабеж видео для гуру =====

Вернемся к "Горящему Лису". Бесплатный плагин под названием **Greasemonkey** (http://www.greasespot.net) позволяет пользователям создавать свои собственные Java-скрипты, внедряющиеся в HTML-код отображаемой страницы и исполняющийся в ее контексте. В частности, мы можем сгенерировать ссылку, позволяющую скачать видео во всех доступных форматах (которые только поддерживает данный сервер) и сохранить его на диск без плясок с бубном, то есть без помощи сторонних сетевых служб или автономных утилит.

Как писать такие скрипты? Хороший вопрос! Для этого нужно быть программистом, знать Яву и HTML. Только… зачем их писать, когда можно взять уже готовые?! На сайте http://userscripts.org (см. рис. 10) их просто куча!!! Например, "**YAGVD: Yet Another Google Video Downloader**" (http://userscripts.org/scripts/show/7582) позволит скачивать видео с Google, а "**YouTube Video Download**" (http://userscripts.org/scripts/show/9511) — c YouTube.

Так же имеются скрипты для обмана iFIlm и других популярных служб. Как говориться, пользуйся — не хочу.

{{youtubed_Image_9.png}}

Рисунок 10 огромная коллекция скриптов, "хакающих" разные сайты

===== >>> врезка конвертируем FLV в AVI =====

**Mplayer** – замечательный кросс-платформенный видеоплеер, поддерживающих практически все существующие типы файлов и позволяющий конвертировать их в любые мыслимые и немыслимые форматы и что самое главное — он абсолютно бесплатен. Последнюю версию всегда можно скачать с официального сайта: http://www.mplayerhq.hu (см. рис. 11).

{{youtubed_Image_10.png}}

Рисунок 11 главная страничка лучшего плеера/кодера Mplayer

В отличии от большинства коммерческих конверторов, осуществляющих преобразование в полностью автоматическом режиме (зачем пугать пользователя обилием настроек?!), mplayer, а, точнее, входящий в комплект его поставки компрессор **mencoder**, предоставляет полный контроль над процессом конвертации, позволяя получать файлы заданного размера с предсказуемым качеством, попутно накладывая разные фильтры (если в этом возникает такая необходимость) — устраняя шумы, удаляя аретефакты сжатия, обрезая никому ненужные черные полосы и т.д., и т. п.

Руководство по mencoder'у (прилагающееся к нему и, кстати говоря, неплохо переведенное на русский язык) занимает не хилое количество страниц и с полпинка в нем не разобраться, особенно, поэтому ниже приводится несложный командный файл, преобразующий FLV файлы в AVI с незначительной пост-обработкой, повышающей их качество.

На первых порах его можно использовать как фундамент, потихоньку осваивая более "продвинутые" опции mencoder'а, позволяющие "вытянуть" из видео-файла максимум качества, на которое он только способен.

REM файл-источник

SET SRC=get_video.flv

REM контейнер-приемник

SET OF=-of:avi

REM файл-приемник

SET O=Lordi-Would-you-love-a-monsterman.avi

REM аудио-кодек

SET OAC=-oac:mp3lame

REM опции аудио-кодека

REM постоянный битрейт, stereo-mode mix, 128 kbit/sec

SET OAO=-lameopts vbr=0:mode=0:br=128 

REM опции аудио-фильтра

REM усиление звука на 13 db

SET AF=-af volume=13

REM видео-кодек

SET OVC=-ovc lavc

REM опции видео-кодека

SET LAVC_A1=:autoaspect:vbitrate=6000

REM быстрое кодирование, аутоаспект, битрейт == 6000 kbit/sec

SET OVO=-lavcopts vcodec=mpeg4:mbd=2:trell:v4mv:turbo

SET OVO=%OVO%%LAVC_A1%

SET CC=-ffourcc xvid

REM выходная частота FPS

REM SET FPS=-ofps 24000/1001

SET FSP=

SET CLI=%SRC% %OF% -o %O% %AID% %OAC% %OAO% %AF% %OVC% %OVO% %CC% %VF% %FPS% -noodml

mencoder %CLI%

Листинг 2 пакетный файл для конвертации FLV файлов в AVI


