====== olly-modz ======
<sub>{{olly-modz.odt|Original file}}</sub>

====== неофициальные сборки ольги —\\ неформальный обзор ======

крис касперски, ака мыщъх, no-email

**OllyDbg**** стал стандартным ****user-land ****отладчиком, взятым на вооружение хакерами, тут же захотевшими ее улучшить (ее — потому, что Ольга женское имя), в результате чего появилось множество нестандартных сборок (модов) — одни фиксят ошибки Ольги, другие расширяют функционал, третьи — скрывают ее от протекторов… количество модов перевалило за третий десяток и чтобы разобраться в этом хозяйстве мыщъх предлагает свой неформальный обзор**

===== введение =====

Отладчик Olly Debugger представляет собой закрытый программный продукт, распространяемый бесплатно, но без исходных текстов и без права модификации двоичных файлов. В лицензионном соглашении прямо так и написано: "**The Software is owned by Oleh Yuschuk ("Author")… You are not allowed to modify, decompile, disassemble or reverse engineer the Software except and only to the extent that such activity is expressly permitted by applicable law. You are not allowed to distribute or use any parts of the Software separately**" ("//Данное программное обеспечение принадлежит Олегу Яшуку, далее именуемому как Автор… Вам не позволено модифицировать, декомпилировать, дизассемблировать Программное Обеспечение за исключением тех и только случаев, когда это разрешается соответствующим законодательством. Вам не позволено распространять или использовать любую часть Программного Обеспечения отдельного от настоящего продукта//" — перевод мой КК).

Выходит, что все моды к Ольге незаконны?! Именно так! Российские законы позволяют дизассемблировать Ольгу и даже модифицировать ее для расширения функционала или исправления ошибок, но вот распространение модифицированных файлов — это уже статья. А что на счет использования готовых модов?! К больному счастью для нас тут действует принцип презумпции невиновности. Откуда мы знаем, быть может, создатель конкретного мода получил от Олега разрешение на модификацию и распространение? А если не получил — то пусть Олег с ним и судится или рассылает всем нам письма (не электронные, а бумажные с уведомлением), что такой-то конкретный мод попирает авторские права и потому мы должны прекратить его использование, удалить его с диска (или предоставить Олегу возможность самостоятельно удалить его, если у нас это не получается сделать, вот пускай прилетает к нам — за свой счет — и удаляет).

Короче говоря, можно смело использовать моды и ни за что не волноваться. Тем более, Олег — мужик нормальный, ни с кем еще не судился, да и зачем ему это?!

{{olly-modz_Image_0.png}}

Рисунок 1 официальный сайт, откуда в любой момент можно скачать оригинальную Ольгу

===== где - что - почем =====

На официальном сайте (см. рис. 1) — http://www.ollydbg.de/ — в настоящий момент доступна для скачивания устаревшая версия 1.08b, самая популярная — 1.10 и недоделанная 2.xx alpha, находящая в стадии активной разработки и серьезно уступающая по функционалу предыдущей версии, зато с полностью переписанным "движком", что в перспективе означает богатые возможности, недоступные ранее.

Подавляющее большинство модов базируются именно на 1.10 версии. Некоторые (очень немногие) — на 1.08 и еще меньше на 2.xx. В самом деле — какой смысл править бинарный файл, если с выходом очередной альфы (а выходят они чуть ли не каждую неделю), весь процесс создания мода необходимо начинать заново, ведь переносить изменения из одной версии в другую приходится вручную, автоматика отдыхает. Эх, вот были бы исходные тексты… Но увы! Исходных текстов нет и по всей видимости и не будет.

Плагины и скрипты, написанные для 1.10,исправно работают в большинстве модов, однако без каких бы то ни было гарантий, особенно если создатели мода захачили его неподетстки, но в таких случаях они, как правило, тестируют популярные плагины на совместимость, при необходимости внося в них соответствующие изменения и закидывая пофиксенный плагин в дистрибутив, распространяемый вместе с модом. А вот при выходе следующий версии мода, в дистрибутиве обычно оказывается лишь сам исполняемый файл и такой дистрибутив имеет подозрительно малый размер (метр, а то и менее того). Поэтому, процедура установки мода выглядит так: находим базовую версию мода (занимающую самый большой размер), качаем, распаковываем архив, ставим. Находим самую последнюю версию, распаковываем в тот же самый каталог. И наслаждаемся. Иногда, правда, приходится скачивать все промежуточные версии, поскольку, в них исправлены те или иные файлы.

Количество одновременно используемых модов ничем не ограничено. Просто ставим их в разные каталоги и все. Исключение составляют Just-In-Time отладчики, вызываемые системой при крахе приложения. JIT-отладчик может быть только один и тут уже приходится выбирать какой из модов (или оригинальную Ольгу) назначать на эту должность. Каталог с плагинами (за исключением тех плагинов, что "заточены" под конкретный мод) так же может быть единым для всех модов — экономия дискового пространства на лицо!

Где искать моды?! Хороший вопрос… Обычно моды выкладываются на файлообменники типа Рапиды, а на хакерские форумы забрасываются ссылки, действующие в течении некоторого времени, а затем… тихо кончающие по причине удаления файла с обменника. Как говорится: кто не успел — тот опоздал и тогда приходится искать моды на хакерских сайтах среди прочего вареза. Довольно внушительная коллекция находится на сервере: http://team-x.ru/guru-exe/index.php?path=Tools%2FDebuggers%2FOllyDbg/.

Поскольку, создатели модов обычно не утруждают себя описаниями, что же именно было модифицировано и чем мод отличается от оригинальной Ольги, приходится качать очень много всякого барахла, оставляя у себя на компьютере в среднем один мод из десяти. Чтобы не повторять эту тупую операцию, мыщъх решил описать самые крутые моды, которые использует сам и рекомендует всем остальным.

{{olly-modz_Image_1.png}}

Рисунок 2 большая коллекция неофициальных модов Ольги на http://team-x.ru/guru-exe/index.php?path=Tools%2FDebuggers%2FOllyDbg/

===== Immunity Debugger =====

Известный мод одноименной фирмы, специализирующейся на безопасности и скрестившей Ольгу 1.10 с Питоном — интерпретируемым языком на котором очень легко и быстро писать скрипты, куча примеров которых (вместе с самим Питоном) идет в дистрибутиве. Конечно, писать скрипты можно прямо в Ольге, но… это не слишком удобно, к тому же все приходится делать вручную, решая типовые задачи (типа поиска в памяти), которые уже давно решены до нас.

В Immunity Debugger входит множество библиотек, написанных на Питоне, и заточенных под хакерские нужды. Эти библиотеки вызываются из Питоновых программ, среди которых значится и searchcrypt.py — отличное средство идентификации следующих криптографических алгоритмов: AES, BLOWFISH, CAMELLIA, CAST, MD5, RC2, RC5, RIPEMD160, SHA1, SHA256, SHA512.

Immunity Debugger используют многие специалисты по безопасности, выкладывающие proof-of-concept expolit'ы, написанные на Питоне и предназначенные для работы исключительно в среде данного отладчика. И хотя хакер с головой разберется в алгоритме работы exploit'а и без Immunity Debugger'а, портируя exploit на любой другой язык, рано или поздно отладчик оказывается на компьютере, зачастую становясь основным инструментов, вытесняющим Ольгу.

Скачать его (после предварительной регистрации) можно прямо с официального сайта: http://www.immunitysec.com/products-immdbg.shtml.

{{olly-modz_Image_2.png}}

Рисунок 3 Immunity Debugger — популярный Ольгин мод с поддержкой Питона

===== >>> врезка баг в Immunity Debugger'е =====

Immunity Debugger содержит один мелкий, но очень неприятный баг. Если удалить Питон с компьютера (или же перенести его в другой каталог) без выполнения процедуры деинсталяции, то Immunity Debugger(по оставшимся записям в реестре) будет считать, что Питон у нас есть и… грохаться при запуске выдавая одну критическую ошибку за другой, на поиск источника которых можно угробить кучу времени. Переустановка Immunity Debugger'а не помогает, т. к. инсталлятор смотрит в реестр и видит, что Питон у нас есть, а потому и не ставит его, заставляя Immunity Debugger снова грохаться при первом же запуске. Проблема решается удалением Питона через Панель Управления/Установка и Удаление Программ с последующей переустановкой Immunity Debugger'а.

{{olly-modz_Image_3.png}}

Рисунок 4 реакция Immunity Debugger'а на удаление/перемещение каталога с Питоном

===== YDbg =====

Популярный и очень мощный мод, основанный на Ольге 1.10 и собравший в своем дистрибутиве огромное количество плагинов, скриптов, а так же кучу других полезных инструментов, в результате чего образовался монстр размеров в целых 27 Мегабайт, несомненно стоящий времени/трафика, потраченного на скачку.

Но все по порядку. В отличии от Immunity Debugger'а, ориентированно на специалистов по безопасности, разрабатывающих exploit'ы, YDbg писался хакерами и для хакеров, ломающих защиты с протекторами, активно сопротивляющиеся такому положению дел и напичканные анти-отладочными приемами, распознающими присутствие Ольги по главному окну с ее именем и пунктам меню.

Первое, что бросается в глаза при запуске YDbg (исполняемый файл которого переименован из OLLYDBG.EXE в SND.exe), это "покореженные" пункты меню (см. рис. 5). В частности, "Memory" превратилось в "M3m0ry", "SEH chain" в "S3H chain", "Breakpoints" в "Br3akp01nts" и т. д. Словом, все "хакерские" пункты изменены — хрен теперь их найдешь (естественно, в новых версиях протекторах наверняка появится детекция YDbg, но пока он успешно скрывается от кучи защит, палящих Ольгу).

Вид кнопочек на панели инструментов изменен на XP стиль. Ну, это, скорее, вопрос вкуса, чем насущная производственная необходимость. Лично меня, например, от XP просто тошнит, но… человек существо неприхотливое и ко всему со временем привыкающее.

{{olly-modz_Image_4.png}}

Рисунок 5 внешний вид YDbg — еще одного популярного хакерского мода Ольги

В состав дистрибутива YDbg входит 36 популярных плагинов (и не нужно теперь рыскать по сети в их поиске!), среди которых затерялся настоящий бриллиант — IDA Sigs, название которого говорит само за себя. Да-да! Это плагин, поддерживающий IDA-сигнатуры и отображающий их в виде комментариев к вызываемых функциям в Ольге или в YDbg (см. рис. 6). Очень удобно!!! Конечно, при наличии IDA Pro можно загрузить исследуемую программу в нее, сохранить все распознанные имена в map, подключаемый к Ольге так же не без помощи плагинов. Но IDA-Pro есть далеко не у всех, да и муторно совершать столько лишних телодвижений. К тому же, если файл упакован, то в Ольге/YDbg мы просто распаковываем его специальным скриптом или аттачимся к уже запущенному процессу, а вот IDA-Pro в этом случае отдыхает.

Сигнатуры (выдернутые из IDA-Pro) так же входят в состав дистрибутива, в комплекте с сигнатурами от различных защит (например, FLEXlm), которых в IDA-Pro нет. Единственный недостаток — в плагине отсутствует автоматический распознаватель сигнатур и потому версию компилятора приходится определять либо с помощью PEiD, либо же последовательно перебирать различные сигнатурные базы одну за другой, пока, наконец, мы не найдем ту, что подходит. Не такая уж большая проблема, но все-таки…

Другой полезный плагин — red-hawk (красный ястреб) представляет собой панельку инструментов, позволяющую, в частности, одним движением мыши установить точки останова на нужные функции, например, в Visual Basic'е это что-то типа __vbaStrCmp или __vbaStrCopy, используемые для сравнения и копирования строк соответственно. Начинающие хакеры просто визжат от восторга, поскольку красный ястреб фактически представляет собой живой учебник по взлому, а так попробуй догадаться что нужно делать!

К сожалению, три плагина не работают и подлежат удалению. PuntosMagicos.dll при запуске YDbg выбрасывает исключение, ведущее к краху. SND Script.dll вызывает динамическую библиотеку MSVCP80.dll, отсутствующую в дистрибутиве моей любимой W2K, а APIHLP.dll зовет MFC71.DLL, которой у меня так же нет. Вообще-то, правила хорошего тона предписывают класть такие вещи в дистрибутив, чтобы не напрягать пользователя их поисками (а искать их в первую очередь нужно на сайте Microsoft, поскольку, они относятся к свободно распространяемым компонентам).

Каталог \SCRIPT содержит 637 скриптов, главным образом предназначенных для снятия различных протекторов/упаковщиков исполняемых файлов и автоматизации всяких рутинных дел. Впечатляющая коллекция! И неплохое пособие для начинающих "как нужно писать скрипты". Так же имеется пара специализированных редакторов, предназначенных для разработки скриптов (один из которых требует .NET, которая у меня стоит только на одной машине, ибо гадость). Опять-таки вопрос вкуса. Мыщъх предпочитает писать скрипты в FAR'е с Colorer'ом, но своих предпочтений никому не навязывает. Пускай каждый решает сам.

Каталог \BIN насчитывает свыше сотни мелких утилит, главным образом надерганных из MS SDK, хотя немало здесь дамперов памяти и других хакерских программ, собранных в одном месте и в совокупности занимающих 11 метров в неупакованном виде. Оно, конечно, удобно, но все-таки трафик денег стоит, а эти утилиты у всех и так давно есть. Или не у всех? Ладно, хвост с ними. Как говорится, лучше иметь, чем не иметь.

На этом достоинства YDbg и заканчиваются. В принципе, это не столько мод, сколько коллекция плагинов, скриптов и сигнатур, весящая, как уже говорилось, 27 мегабайт в упакованном виде. У кого быстрый модем и дешевый Интернет — почему бы и не скачать?! http://team-x.ru/guru-exe/Tools/Debuggers/OllyDbg/OllyDbg%20v1.10%20YDbg%20Beta.7z. Слово "beta" в названии навевает не очень-то приятные ассоциации (щас все упадет, заглючит), однако, мыщъх работает и… пока полет нормальный.

{{olly-modz_Image_5.png}}

Рисунок 6 YDbg за работой

===== >>> врезка хитрый поиск глючного плагина =====

При последовательной установке планинов никаких проблем не возникает. Если свежеустановленный плаги приводит к краху Ольги (или мода), то просто удаляем его и все! (Ну, или, если это действительно нужный плагин, трахаемся с ним до упаду, пока не выясним в чем конфликт и как его устранить).

Но вот при пакетной установке плагинов или запуске мода с кучей предустановленных плагинов… Коварная Ольга не сообщает имя плагина, который она в данный момент грузит и потому остается только гадать кто из них гадит. Классическое решение проблемы – последовательное перемещение плагинов в другой каталог. Как только исключение исчезло — последний перемещенный плагин и есть виновник. Но при большом количестве плагинов операция поиска отнимает слишком много времени и возникает желание в ее оптимизации. ОК, перемещаем половину плагинов и смотрим результат. Если исключение исчезло, значит, глючный плагин находится в первой половине, если же нет – то во второй. Найденную половину вновь делим на две части и повторяем эту операцию до тех пор, пока делить будет нечего.

Но это вовсе не предел оптимизации! Поскольку, плагины грузятся последовательно, а исключение, как правило, возникает в процедуре их инициализации, то в большинстве случаев достаточно удалить/переместить последний загруженный плагин. Операционная система автоматически обновляет дату/время последнего обращения к файлу, просмотреть которую в FAR'е можно по <CTRL-A> (см. рис. 7), а отсортировать плагины в порядке убывания/возрастания времени последнего обращения по <CTRL-F9>. Просто скользим по списку файлов вниз (или же распахиваем панель на весь экран в детализированном режиме, как видим, что сначала идут плагины с одинаковым временем последнего обращения, а потом наступает "разрыв" равный промежутку между двумя последними запусками Ольги. Тот плагин, что стоит на границе разрыва — с высокой степени вероятности и есть глюкало. Удаляем/перемещаем его и перезапускаем Ольгу/мод.

Однако, подобная техника срабатывает далеко не всегда. Случается конфликт нескольких плагинов, иногда трех и более сразу. Некоторые плагины, загружаемые первыми, не вызывают исключения, зато "обламывают" кучу других плагинов, грузящихся после них, в результате чего мы удаляем большое количество ни в чем не повинных плагинов, лишаясь значительной части функционала.

В общем, плагины — дело тонкое. И подбирать их нужно аккуратно, как бриллианты в корону, чего, к сожалению, разработчики большинства модов не делают, даже не утруждая себя тестированием образовавшейся коллекции.

{{olly-modz_Image_6.png}}

Рисунок 7 поиск сбойного плагина по времени последнего обращения

===== моя твоя не понимает! =====

Английский, конечно, обще-хакерский международный и без него много не нахачишь, но особенности национальных реалий таковы, что толпа народу с английским на "вы" и только со словарем. Русский чисто психологически воспринимается намного более комфортно и русификация процветает. Лично мыщъх встречает локализованные программы в штыки (в частности, на диске, прилагаемом к материнской плате, что мне "посчастливилось" купить, лежала локализованная версия Nero Express, в которой "громкость" ("volume") переведена как "том". Пример яркий, но не единственный. Локализация — своеобразная интеллектуальная игра "как, черт побери, это звучало в оригинале?!". Потом, все мануалы в своей массе используют оригинальные программы, что сильно напрягает владельцев русифицированных версий при их чтении. Попробуй, с ходу разберись в какой пункт нырять, особенно если отсутствует скрин).

Ладно, все это лирика. Нужен локализованный мод Ольги (см. рис. 8), берем, качаем: http://team-x.ru/guru-exe/Tools/Debuggers/OllyDbg/OllyDbg%20v1.10%20Russian.rar

{{olly-modz_Image_7.png}}

Рисунок 8 внешний вид локализованного мода Ольги

===== красота, спасающая мир =====

Мыщъх любит сыр и консоль, а вот XP не переваривает. Органически. Клава рулит. А тыкать курсом в иноки — это вообще не по-хакерски. Впрочем, как уже говорилось, о вкусах не спорят и если кто-то сидит под XP (а сидят под ней многие) и хочет, чтобы Ольга была такой же красивой с пурпурными пуговицами, то… почему бы и нет?! Можно использовать либо YDbg (он как раз в таком стиле и сделан), либо более легковесный мод, не делающий ничего, кроме смены стиля (см. рис. 9) и потому в упакованном виде весящий меньше, чем мегабайт: http://team-x.ru/guru-exe/Tools/Debuggers/OllyDbg/OllyDbg%20v1.10%20XP.rar

{{olly-modz_Image_8.png}}

Рисунок 9 внешний вид мода Ольги, оформленного в XP-стиле

===== заключение =====

Мы рассмотрели только четыре мода из трех десятков выложенных на team-x. Что делают все остальные? Readme, традиционно приложенный к архиву, "позаимствован" у оригинала и скопирован без изменений. file_id.diz (в тех редких случаях когда он есть), обычно говорит, что это мод Ольги, но не конкретизирует, что именно модифицировано, поэтому, имя архива — практически единственная информация, имеющаяся в нашем распоряжении.

Возьмем, например, "OllyDbg v1.10 ExeCryptor" (http://team-x.ru/guru-exe/Tools/Debuggers/OllyDbg/OllyDbg%20v1.10%20ExeCryptor.rar). Как нетрудно догадаться, он предназначен для сокрытия Ольги от протектора ExeCryptor, а распаковав архив мы обнаружим набор плагиров, скриптов и прочих полезных вещей, существенно упрощающих взлом запротекченных программ.

Или вот, скажем, "OllyDbg v1.0 9in1 for Themida" (http://team-x.ru/guru-exe/Tools/Debuggers/OllyDbg/OllyDbg%20v1.0%209in1%20for%20Themida.rar) — мод, скрывающий Ольгу от Фемиды и состоящий всего из одного-единственного исполняемого файла, который предполагается скопировать в каталог с оригинальной Ольгой.

К сожалению, данная методика срабатывает далеко не всегда и огромное количество модов носят бессмысленнее, ничего не говорящие имена. Тут уместно вспомнить поговорку: как вы яхту назовете, так она и поплывет. Или не поплывет. То есть останется незамеченной хакерской общественностью.

Очень многие создатели модов ограничиваются тем, что пакуют Ольгу Фемидой или другим крутым протектором, препятствующим доступ к адресному пространству процесса-отладчика со стороны отлаживаемых приложений и тем самым предотвращающий его обнаружение. Ну, упаковать Ольгу — много ума не надо. Это можно сделать и самостоятельно, параллельно с этим изменив заголовок главного окна и пункты меню в hex-редакторе.

Моды размером меньше пары мегабайт лучше не качать (если только мы заранее не убеждены, что хотим их скачать) — ничего интересного там все равно не будет. Чем больше размер — тем больше накидано в него плагинов, скриптов и прочих тулз, возможно, даже не имеющих к моду никакого отношения, но… как ни парадоксально, самые большие и тщательно отобранные коллекции плагинов/скрипитов содержаться именно в модах.


